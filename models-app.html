<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMArena Text Model Rankings</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        h2 {
            text-align: center;
            color: #2c3e50;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 300;
            letter-spacing: -0.5px;
            margin: 10px 0 5px 0;
        }
        .chart-container {
            width: 100%;
            max-width: 100vw;
            margin: 0 auto;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .charts-wrapper {
            display: flex;
            gap: 2%;
            justify-content: space-between;
            width: 100%;
        }

        .chart-section {
            flex: 1;
            min-width: 0;
        }

        .chart-title {
            text-align: center;
            font-size: 18px;
            font-weight: 500;
            color: #34495e;
            margin-bottom: 5px;
        }


        .legend {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .legend h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #2c3e50;
            text-align: center;
        }

        .legend-items {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            border: 1px solid #ddd;
        }

        .ollama-table {
            margin: 20px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .ollama-table h3 {
            margin: 0 0 12px 0;
            font-size: 16px;
            color: #2c3e50;
            text-align: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 300;
            letter-spacing: -0.5px;
        }

        .ollama-table table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .ollama-table th {
            background-color: #34495e;
            color: white;
            padding: 8px 6px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .ollama-table td {
            padding: 6px 6px;
            border-bottom: 1px solid #e9ecef;
            font-size: 11px;
            color: #2c3e50;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .ollama-table tr:last-child td {
            border-bottom: none;
        }

        .ollama-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .ollama-table tr:hover {
            background-color: #e8f4f8;
        }

        .ollama-table .size-cell {
            font-weight: 600;
            color: #2c3e50;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }

        .ollama-table .pulls-cell {
            text-align: right;
            font-weight: 600;
            color: #27ae60;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 11px;
        }

        .ollama-table .categories-cell {
            font-size: 10px;
            color: #666;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .size-badge {
            display: inline-block;
            padding: 3px 8px;
            background-color: #3498db;
            color: white;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
            min-width: 35px;
        }

        .y-axis text {
            font-size: 11px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-weight: 500;
            text-anchor: end;
            dominant-baseline: middle;
        }

        .label {
            font-size: 11px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 600;
        }

        .x-axis text {
            font-size: 10px;
        }

        .bar {
            rx: 3;
            ry: 3;
            filter: drop-shadow(0 1px 3px rgba(0,0,0,0.1));
        }

        .grid line {
            stroke: #e0e0e0;
            stroke-dasharray: 2,2;
            stroke-width: 0.5;
        }

        .grid path {
            stroke-width: 0;
        }

        /* Responsive design */
        @media (max-width: 1200px) {
            .charts-wrapper {
                flex-direction: column;
                gap: 30px;
            }

            .chart-section {
                max-width: 100%;
            }

            h2 {
                font-size: 24px;
            }
        }

        @media (max-width: 768px) {
            .chart-container {
                padding: 0 5px;
            }

            h2 {
                font-size: 20px;
            }

            .chart-title {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="chart-container">
        <h2>Top Text LLMs - Arena Score vs Voting Score</h2>
        <p style="text-align: center; margin: 2px 0 10px 0; font-size: 16px; color: #666; font-style: italic;">
            Discover non-proprietary models in Ollama
        </p>

        <div class="charts-wrapper">
            <div class="chart-section">
                <div class="chart-title">Arena Score</div>
                <div id="chart-arena"></div>
            </div>
            <div class="chart-section">
                <div class="chart-title">Voting Score</div>
                <div id="chart-voting"></div>
            </div>
        </div>

        <div class="legend">
            <h3>License Types</h3>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #666;"></div>
                    <span>Proprietary</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #2ecc71;"></div>
                    <span>MIT</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #3498db;"></div>
                    <span>Apache 2.0</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #bdc3c7;"></div>
                    <span>Unknown</span>
                </div>
            </div>
            <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #666; font-style: italic;">
                * Available in Ollama (yellow highlight) | ðŸ“¦ Small Ollama Models 8B and smaller (yellow highlight)
            </div>
        </div>

        <div class="ollama-table">
            <h3>Small Ollama Models (8B and smaller)</h3>
            <p style="font-size: 12px; color: #666; margin: 5px 0; font-style: italic;">
                ðŸ“Š <span style="background-color: #fff9c4; padding: 1px 3px; border-radius: 2px;">Yellow highlighted models</span> are confirmed matches in the Arena Score chart above
            </p>
            <table id="ollama-models-table">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Size</th>
                        <th>Pulls</th>
                        <th>Categories</th>
                    </tr>
                </thead>
                <tbody id="ollama-models-tbody">
                    <!-- Table rows will be populated by JavaScript -->
                </tbody>
            </table>
        </div>

       

    <script>
        const margin = { top: 20, right: 60, bottom: 30, left: 250 };

        // Calculate responsive width
        function getChartWidth() {
            const containerWidth = document.querySelector('.chart-section')?.offsetWidth || 800;
            const availableWidth = containerWidth - margin.left - margin.right - 10; // Extra padding
            return Math.max(250, availableWidth);
        }

        // Dynamic height calculation based on number of models
        function getChartHeight(dataLength) {
            const barHeight = 20; // Height per model bar
            const minHeight = 400;
            return Math.max(minHeight, dataLength * barHeight);
        }


        // Initialize charts with responsive sizing
        function initializeChartElements(dataLength) {
            const width = getChartWidth();
            const height = getChartHeight(dataLength);

            // Create Arena Score Chart
            const svgArena = d3.select("#chart-arena")
                .append("svg")
                .attr("width", "100%")
                .attr("height", height + margin.top + margin.bottom)
                .attr("viewBox", `0 0 ${width + margin.left + margin.right} ${height + margin.top + margin.bottom}`)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const xArena = d3.scaleLinear().range([0, width]);
            const yArena = d3.scaleBand().range([0, height]).padding(0.1);

            const xAxisArena = svgArena.append("g")
                .attr("transform", `translate(0,${height})`)
                .attr("class", "x-axis");

            const yAxisArena = svgArena.append("g")
                .attr("class", "y-axis");

            const gridArena = svgArena.append("g")
                .attr("class", "grid");

            // Create Voting Score Chart
            const svgVoting = d3.select("#chart-voting")
                .append("svg")
                .attr("width", "100%")
                .attr("height", height + margin.top + margin.bottom)
                .attr("viewBox", `0 0 ${width + margin.left + margin.right} ${height + margin.top + margin.bottom}`)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const xVoting = d3.scaleLinear().range([0, width]);
            const yVoting = d3.scaleBand().range([0, height]).padding(0.1);

            const xAxisVoting = svgVoting.append("g")
                .attr("transform", `translate(0,${height})`)
                .attr("class", "x-axis");

            const yAxisVoting = svgVoting.append("g")
                .attr("class", "y-axis");

            const gridVoting = svgVoting.append("g")
                .attr("class", "grid");

            return {
                width, height,
                svgArena, xArena, yArena, xAxisArena, yAxisArena, gridArena,
                svgVoting, xVoting, yVoting, xAxisVoting, yAxisVoting, gridVoting
            };
        }

        const animationSpeed = 750;

        // Function to truncate long model names
        function truncateText(text, maxLength = 35) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength - 3) + '...';
        }

        // Function to format numbers with thousand separators
        function formatNumber(num) {
            if (!num) return "";
            return Math.round(num).toLocaleString();
        }

        // Color scale for license types
        const licenseColors = {
            'Proprietary': '#666',
            'MIT': '#2ecc71',
            'Apache 2.0': '#3498db',
            '': '#bdc3c7'  // Default for empty/unknown license
        };



        function updateChart(data, scoreType, svg, x, y, xAxis, yAxis, grid, height) {
            const scoreField = scoreType === 'arena' ? 'arena_score' : 'voting_score';
            const sortedData = data.sort((a, b) => b[scoreField] - a[scoreField]);
            const paddedData = sortedData; // Show all models, no limit

            x.domain([0, d3.max(sortedData, d => d[scoreField]) + 50]);
            y.domain(paddedData.map((_, i) => i.toString()));

            xAxis.transition().duration(animationSpeed).call(d3.axisBottom(x).ticks(5));
            yAxis.transition().duration(animationSpeed).call(d3.axisLeft(y).tickFormat(i => truncateText(paddedData[i].model)));

            // Add subtle grid lines
            grid.transition().duration(animationSpeed)
                .call(d3.axisBottom(x)
                    .ticks(5)
                    .tickSize(-height)
                    .tickFormat("")
                );

            // Add subtle background rectangles for Ollama models (including small Ollama models)
            const smallOllamaModels = Object.values(ollamaToArenaMapping);
            yAxis.selectAll(".ollama-bg").remove(); // Remove existing backgrounds
            yAxis.selectAll(".ollama-bg")
                .data(paddedData.map((d, i) => ({...d, index: i})).filter(d => d.isInOllama || smallOllamaModels.includes(d.model)))
                .enter()
                .append("rect")
                .attr("class", "ollama-bg")
                .attr("x", -245)
                .attr("y", (d) => y(d.index.toString()) + 1)
                .attr("width", 240)
                .attr("height", y.bandwidth() - 2)
                .attr("fill", "#fff9c4")
                .attr("stroke", "#f9d71c")
                .attr("stroke-width", 0.5)
                .attr("rx", 2)
                .attr("ry", 2)
                .attr("opacity", 0.8);



            // Color the y-axis text based on license and Ollama availability
            yAxis.selectAll(".tick text")
                .attr("fill", (d, i) => {
                    if (!paddedData[i]) return "#000";

                    // Black text for all Ollama models (on yellow background)
                    if (paddedData[i].isInOllama) {
                        return "#000";
                    }

                    // Grey only for proprietary models
                    if (paddedData[i].license === "Proprietary") {
                        return "#999";
                    }

                    // Black for open source and unknown models
                    return "#000";
                });

            const bars = svg.selectAll(".bar")
                .data(paddedData, (d, i) => d.model || i);

            bars.enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", 0)
                .attr("y", (d, i) => y(i.toString()))
                .attr("height", y.bandwidth())
                .attr("rx", 3)
                .attr("ry", 3)
                .attr("fill", d => d.model ? (licenseColors[d.license] || licenseColors['']) : "transparent")
                .attr("width", 0)
                .merge(bars)
                .transition()
                .duration(animationSpeed)
                .attr("x", 0)
                .attr("y", (d, i) => y(i.toString()))
                .attr("width", d => x(d[scoreField]))
                .attr("height", y.bandwidth())
                .attr("fill", d => d.model ? (licenseColors[d.license] || licenseColors['']) : "transparent");

            bars.exit().remove();

            const labels = svg.selectAll(".label")
                .data(paddedData, (d, i) => d.model || i);

            labels.enter()
                .append("text")
                .attr("class", "label")
                .attr("x", d => Math.min(x(d[scoreField]) + 5, x.range()[1] - 40))
                .attr("y", (d, i) => y(i.toString()) + y.bandwidth() / 2)
                .attr("dy", "0.35em")
                .merge(labels)
                .transition()
                .duration(animationSpeed)
                .attr("x", d => Math.min(x(d[scoreField]) + 5, x.range()[1] - 40))
                .attr("y", (d, i) => y(i.toString()) + y.bandwidth() / 2)
                .attr("fill", d => d.license === "Proprietary" ? "#999" : "#000")
                .text(d => formatNumber(d[scoreField]));

            labels.exit().remove();
        }

        // Function to load ollama models for comparison
        async function loadOllamaModels() {
            try {
                const response = await fetch('ollama-models.csv');
                const csvText = await response.text();
                const lines = csvText.trim().split('\n');
                const ollamaModels = new Set();

                // Skip header and extract model names
                lines.slice(1).forEach(line => {
                    const modelName = line.split(',')[0];
                    if (modelName) {
                        ollamaModels.add(modelName.trim());
                    }
                });

                return ollamaModels;
            } catch (error) {
                console.error('Error loading Ollama models:', error);
                return new Set();
            }
        }

        // Function to load ollama models for the table (8B and smaller)
        async function loadOllamaModelsForTable() {
            try {
                const response = await fetch('ollama-models.csv');
                const csvText = await response.text();
                const lines = csvText.trim().split('\n');
                const models = [];

                // Skip header and parse each line
                lines.slice(1).forEach(line => {
                    // Parse CSV line with proper handling of quoted fields
                    const fields = [];
                    let current = '';
                    let inQuotes = false;

                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            fields.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    fields.push(current.trim()); // Add the last field

                    if (fields.length >= 6) {
                        const modelName = fields[1]; // model_name field
                        const size = fields[5]; // size field

                        if (modelName && size && isSmallModel(size)) {
                            models.push({
                                name: modelName,
                                size: size
                            });
                        }
                    }
                });

                return models;
            } catch (error) {
                console.error('Error loading Ollama models for table:', error);
                return [];
            }
        }

        // Function to check if a model size is 8B or smaller
        function isSmallModel(size) {
            if (!size) return false;

            const sizeStr = size.toLowerCase();

            // Handle different size formats
            if (sizeStr.includes('m')) {
                // Megabyte models (like 135M, 360M) - these are smaller than 1B
                return true;
            }

            if (sizeStr.includes('b')) {
                // Extract number before 'b'
                const match = sizeStr.match(/(\d+(?:\.\d+)?)b/);
                if (match) {
                    const num = parseFloat(match[1]);
                    return num <= 8;
                }
            }

            // Handle special cases like "8x7b" (mixture of experts)
            if (sizeStr.includes('x')) {
                const parts = sizeStr.split('x');
                if (parts.length === 2) {
                    const secondPart = parts[1].toLowerCase();
                    if (secondPart.includes('b')) {
                        const match = secondPart.match(/(\d+(?:\.\d+)?)b/);
                        if (match) {
                            const num = parseFloat(match[1]);
                            return num <= 8;
                        }
                    }
                }
            }

            return false;
        }

        // Function to populate the Ollama models table
        function populateOllamaTable(models) {
            const tbody = document.getElementById('ollama-models-tbody');
            if (!tbody) return;

            // Sort models: first by size (largest to smallest), then alphabetically by name
            models.sort((a, b) => {
                const sizeA = getSortableSize(a.size);
                const sizeB = getSortableSize(b.size);

                if (sizeA !== sizeB) {
                    return sizeB - sizeA;
                }

                return a.name.localeCompare(b.name);
            });

            // Clear existing rows
            tbody.innerHTML = '';

            // Add rows
            models.forEach(model => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${model.name}</td>
                    <td><span class="size-badge">${model.size}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Function to convert size to sortable number
        function getSortableSize(size) {
            if (!size) return 0;

            const sizeStr = size.toLowerCase();

            if (sizeStr.includes('m')) {
                const match = sizeStr.match(/(\d+(?:\.\d+)?)m/);
                if (match) {
                    return parseFloat(match[1]) / 1000; // Convert MB to GB equivalent
                }
            }

            if (sizeStr.includes('b')) {
                const match = sizeStr.match(/(\d+(?:\.\d+)?)b/);
                if (match) {
                    return parseFloat(match[1]);
                }
            }

            // Handle mixture of experts like "8x7b" - use the second number
            if (sizeStr.includes('x')) {
                const parts = sizeStr.split('x');
                if (parts.length === 2) {
                    const secondPart = parts[1].toLowerCase();
                    if (secondPart.includes('b')) {
                        const match = secondPart.match(/(\d+(?:\.\d+)?)b/);
                        if (match) {
                            return parseFloat(match[1]);
                        }
                    }
                }
            }

            return 0;
        }

        // Function to load and process CSV data
        async function loadCSVData() {
            try {
                const [lmarenaResponse, ollamaModels] = await Promise.all([
                    fetch('lmarena_text.csv'),
                    loadOllamaModels()
                ]);
                const csvText = await lmarenaResponse.text();

                // Parse CSV with proper handling of quoted fields
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',');

                const data = lines.slice(1).map(line => {
                    // Simple CSV parser that handles basic cases
                    const values = [];
                    let current = '';
                    let inQuotes = false;

                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            values.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    values.push(current.trim()); // Add the last value

                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });

                    // Convert arena_score to number and votes
                    const arenaScore = parseInt(row.arena_score);
                    const votes = parseInt(row.votes);

                    // Check if model is available in Ollama
                    const isInOllama = ollamaModels.has(row.model);
                    const displayName = isInOllama ? `${row.model} *` : row.model;

                    return {
                        date: "2025-01-01",
                        model: displayName,
                        arena_score: arenaScore,
                        voting_score: votes,
                        license: row.license || "",
                        isInOllama: isInOllama
                    };
                });

                // Return all models and return
                return data;

            } catch (error) {
                console.error('Error loading CSV:', error);
                // No fallback
                return [];
            }
        }

        // Initialize both charts with CSV data
        async function initializeCharts() {
            const [data, ollamaTableModels] = await Promise.all([
                loadCSVData(),
                loadOllamaModelsForTable()
            ]);

            const chartElements = initializeChartElements(data.length);

            updateChart(data, 'arena', chartElements.svgArena, chartElements.xArena, chartElements.yArena,
                       chartElements.xAxisArena, chartElements.yAxisArena, chartElements.gridArena, chartElements.height);
            updateChart(data, 'voting', chartElements.svgVoting, chartElements.xVoting, chartElements.yVoting,
                       chartElements.xAxisVoting, chartElements.yAxisVoting, chartElements.gridVoting, chartElements.height);

            // Populate the Ollama models table
            populateOllamaTable(ollamaTableModels);
        }

        // Define mapping between Ollama models and LMArena models
        const ollamaToArenaMapping = {
            'Llama-3.1-8B': 'Meta-Llama-3.1-8B-Instruct',
            'Llama-3.2-3B': 'Meta-Llama-3.2-3B-Instruct',
            'Llama-3.2-1B': 'Meta-Llama-3.2-1B-Instruct',
            'Mistral-7B': 'Mistral-7B-Instruct-v0.2',
            'Gemma2-2B': 'Gemma-2-2b-it',
            'Gemma-7B': 'Gemma-7B-it',
            'Gemma-2B': 'Gemma-2B-it'
        };

        // Function to load and populate Ollama models table
        async function loadOllamaModelsTable() {
            try {
                const response = await fetch('ollama-models.csv');
                const csvText = await response.text();
                const lines = csvText.trim().split('\n');
                const ollamaData = [];

                // Skip header and parse each line
                lines.slice(1).forEach(line => {
                    // Parse CSV line with proper handling of quoted fields
                    const fields = [];
                    let current = '';
                    let inQuotes = false;

                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            fields.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    fields.push(current.trim()); // Add the last field

                    if (fields.length >= 7) {
                        ollamaData.push({
                            model_name: fields[1], // model_name field
                            categories: fields[4], // categories field
                            size: fields[5], // size field
                            pulls: fields[6] // pulls field
                        });
                    }
                });

                // Filter for models 8B and smaller
                const smallModels = ollamaData.filter(model => {
                    const size = model.size;
                    if (!size) return false;

                    // Convert size to comparable number
                    const sizeNum = parseSizeToNumber(size);
                    return sizeNum <= 8000; // 8B = 8000M
                });

                // Sort by pulls (largest to smallest), then alphabetically by model name
                smallModels.sort((a, b) => {
                    const pullsA = parsePullsToNumber(a.pulls);
                    const pullsB = parsePullsToNumber(b.pulls);

                    if (pullsA !== pullsB) {
                        return pullsB - pullsA;
                    }

                    // Secondary sort by model name
                    return a.model_name.localeCompare(b.model_name);
                });

                // Populate table
                const tbody = document.getElementById('ollama-models-tbody');
                tbody.innerHTML = '';

                smallModels.forEach(model => {
                    const row = document.createElement('tr');

                    // Model name cell
                    const modelCell = document.createElement('td');
                    modelCell.textContent = model.model_name;

                    // Highlight if this model matches Arena data
                    if (ollamaToArenaMapping[model.model_name]) {
                        modelCell.style.backgroundColor = '#fff9c4';
                        modelCell.style.border = '1px solid #f9d71c';
                        modelCell.style.borderRadius = '3px';
                        modelCell.style.padding = '2px 4px';
                        modelCell.title = `ðŸ“Š Available in LMArena as: ${ollamaToArenaMapping[model.model_name]}`;
                    }

                    row.appendChild(modelCell);

                    // Size cell
                    const sizeCell = document.createElement('td');
                    sizeCell.textContent = model.size;
                    sizeCell.className = 'size-cell';
                    row.appendChild(sizeCell);

                    // Pulls cell
                    const pullsCell = document.createElement('td');
                    pullsCell.textContent = model.pulls || '';
                    pullsCell.className = 'pulls-cell';
                    pullsCell.style.textAlign = 'right';
                    row.appendChild(pullsCell);

                    // Categories cell
                    const categoriesCell = document.createElement('td');
                    categoriesCell.textContent = model.categories || '';
                    categoriesCell.className = 'categories-cell';
                    row.appendChild(categoriesCell);

                    tbody.appendChild(row);
                });

            } catch (error) {
                console.error('Error loading Ollama models:', error);
                const tbody = document.getElementById('ollama-models-tbody');
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #666;">Error loading models data</td></tr>';
            }
        }

        // Helper function to convert size strings to numbers for sorting
        function parseSizeToNumber(sizeStr) {
            if (!sizeStr) return 0;

            const size = sizeStr.toLowerCase();

            // Handle different size formats
            if (size.includes('m')) {
                return parseFloat(size.replace('m', ''));
            } else if (size.includes('b')) {
                return parseFloat(size.replace('b', '')) * 1000;
            } else if (size.includes('k')) {
                return parseFloat(size.replace('k', '')) / 1000;
            } else if (size.includes('x')) {
                // Handle MoE models like "8x7b" - use the second number
                const parts = size.split('x');
                if (parts.length === 2) {
                    return parseFloat(parts[1].replace('b', '')) * 1000;
                }
            }

            // Try to parse as number
            const num = parseFloat(size);
            return isNaN(num) ? 0 : num;
        }

        // Helper function to convert pulls strings to numbers for sorting
        function parsePullsToNumber(pullsStr) {
            if (!pullsStr) return 0;

            const pulls = pullsStr.toLowerCase();

            // Handle different pulls formats
            if (pulls.includes('m')) {
                return parseFloat(pulls.replace('m', '')) * 1000000;
            } else if (pulls.includes('k')) {
                return parseFloat(pulls.replace('k', '')) * 1000;
            }

            // Try to parse as number
            const num = parseFloat(pulls);
            return isNaN(num) ? 0 : num;
        }

        // Start the application when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            initializeCharts();
            loadOllamaModelsTable();
        });

    </script>
            <div style="text-align: center; margin-bottom: 10px; font-size: 14px; color: #666;">
            Data from <a href="https://lmarena.ai/leaderboard" target="_blank" style="color: #3498db;">LMArena Leaderboard</a> |
            CSV source 2025.09.02 Latest: <a href="https://github.com/fboulnois/llm-leaderboard-csv/releases" target="_blank" style="color: #3498db;">llm-leaderboard-csv</a>
        </div>
</body>
</html>
